<header class="site-header">
  <div class="container inner">
    <a class="brand" href="/">
      <img class="logo" src="/images/logo.png" alt="Condo Database logo">
      <span class="title">Condo Database</span>
    </a>

    <nav class="nav">
    </nav>
  </div>
</header>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Listings — Condo Database</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- Header / Nav -->
  <header>
    <nav class="navbar">
      <div class="logo-container">
        <a href="index.html" aria-label="Condo Database home">
          <img src="images/logo.png" alt="Condo Database" class="logo">
        </a>
      </div>
      <ul>
        <li><a href="listings.html">Listings</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="admin/">Admin</a></li>
      </ul>
    </nav>
  </header>

  <!-- Banner -->
  <section class="hero" style="background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.35)), url('images/hero.jpg') center/cover no-repeat; color:#fff; padding:28px 20px;">
    <div class="container">
      <h1 style="margin:0 0 6px 0;">Available Listings</h1>
      <p style="margin:0; opacity:.95;">Browse our curated Bangkok condos. Updated daily via our CMS.</p>
    </div>
  </section>

  <!-- Listings -->
  <main class="container" style="padding:24px 20px;">
    <div id="listings"></div>
  </main>

  <footer class="container" style="padding:40px 20px; color:#555;">
    <strong>Condo Database</strong><br>
    Bangkok, Thailand
  </footer>

  <script>
    // Render helper (with "Rented until" note if applicable)
    function cardHTML(d) {
      const rentedNote = (d.availability === 'Rented' && d.rented_until)
        ? `<span style="color:#d00">Rented until ${d.rented_until}</span>`
        : (d.availability || '');

      return `
        <article style="border:1px solid #eee;border-radius:12px;padding:16px;margin:14px 0;box-shadow:0 2px 10px rgba(0,0,0,.04);">
          <h3 style="margin:0 0 10px 0">${d.title || 'Listing'}</h3>
          <p style="margin:6px 0"><strong>Price:</strong> ${d.price ? d.price.toLocaleString() : ''} THB/month</p>
          <p style="margin:6px 0"><strong>Size:</strong> ${d.size || ''} sqm</p>
          <p style="margin:6px 0"><strong>Status:</strong> ${rentedNote}</p>
          ${d.images && d.images.length ? `<img src="${d.images[0]}" alt="${d.title || 'Listing'}" style="max-width:100%;border-radius:8px;margin-top:10px">` : ''}
        </article>`;
    }

    // Fetch markdown-based listings (Netlify CMS output)
    // Each file in /content/listings should have frontmatter with the fields we’ve been using.
    async function loadListings() {
      const container = document.getElementById('listings');
      try {
        // Index: fetch directory list via GitHub Pages style is non-trivial.
        // Simplest: maintain a small JSON manifest OR list files explicitly.
        // For now we will fetch two example files if present:
        const files = [
          'content/listings/example-2bed-asoke.json',
          'content/listings/example-1bed-thonglo.json'
        ];

        const items = [];
        for (const path of files) {
          try {
            const res = await fetch(path);
            if (res.ok) {
              const data = await res.json();
              items.push(data);
            }
          } catch(e){}
        }

        if (!items.length) {
          container.innerHTML = `<p>No listings yet. Add some in the CMS (Admin) and redeploy.</p>`;
          return;
        }

        container.innerHTML = items.map(cardHTML).join('');
      } catch (e) {
        container.innerHTML = `<p>Could not load listings.</p>`;
      }
    }
    loadListings();
  </script>
</body>
</html>
